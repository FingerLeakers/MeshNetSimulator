<!DOCTYPE html>

<html>
<head>
  <meta charset="utf-8">
  <title>MeshNet Simulator</title>
  <link rel="stylesheet" type="text/css" href="style.css">

<!--
  <script src="https://d3js.org/d3-collection.v1.min.js"></script>
-->
  <script src="d3/d3-collection.v1.min.js"></script>
  <script src="d3/d3-dispatch.v1.min.js"></script>
  <script src="d3/d3-quadtree.v1.min.js"></script>
  <script src="d3/d3-timer.v1.min.js"></script>
  <script src="d3/d3-force.v1.min.js"></script>
  <script src="d3/d3-zoom.v1.min.js"></script>
  <script src="d3/d3-drag.v1.min.js"></script>
  <script src="d3/d3-selection.v1.min.js"></script>
  <script src="d3/d3-interpolate.v1.min.js"></script>
  <script src="d3/d3-ease.v1.min.js"></script>
  <script src="d3/d3-color.v1.min.js"></script>
  <script src="d3/d3-transition.v1.min.js"></script>

  <script src="math.js"></script>
  <script src="draw.js"></script>
  <script src="graph.js"></script>
  <script src="edit.js"></script>

<script>
var data = { graph: {
  links: [
    {
      "source": 0,
      "target": 1,
      "tq": 1.008,
      "vpn": true,
      "id": '62e327ff8a64-eade27b88dbe'
    }
  ],
  nodes: [
    {
      "id": "62:e3:27:ff:8a:64",
      "clients": 4,
      "label": "abc",
      "name" : "Node1"
    },
    {
      "id": "ea:de:27:b8:8d:be",
      "clients": 1,
      "label": "123",
      "name" : "Node2"
    }
  ]
}};

// https://www.w3schools.com/howto/howto_js_tabs.asp
function showTab(evt, tabname) {
  var tabcontent = document.getElementsByClassName("tabcontent");
  for (var i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  var tablinks = document.getElementsByClassName("tablinks");
  for (var i = 0; i < tablinks.length; i++) {
    tablinks[i].classList.remove('active');
  }

  document.getElementById(tabname).style.display = "block";
  evt.currentTarget.classList.add('active');
}

var graph;
var edit;

function getInt(id) {
  return Math.floor(parseInt(document.getElementById(id).value, 10));
}

function getBool(id) {
  return document.getElementById(id).checked;
}

function start() {
  // replace index by node object
  data.graph.links.forEach(function (d) {
    d.source = data.graph.nodes[d.source];
    d.target = data.graph.nodes[d.target];
  });

  graph = createGraph();
  graph.render(document.getElementsByClassName("display")[0]);
  graph.resetView();

  edit = createEdit(graph);
}
  </script>
</head>
<body onload="start()">
  <div class="container">
    <div class="toolbar">
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'File')">File</button>
        <button class="tablinks" onclick="showTab(event, 'Edit')">Edit</button>
        <button class="tablinks" onclick="showTab(event, 'Sim')">Sim</button>
      </div>
      <div id="File" class="tabcontent">
        <input type="button" onclick="edit.load()" value="Load">
        <input type="button" onclick="edit.save()" value="Save">
        <select>
          <option value="meshviewer">MeshViewer</option>
          <option value="netjson">NetJSON</option>
        </select>
      </div>

      <div id="Edit" class="tabcontent">
        <input type="button" onclick="graph.removeSelected()" value="remove selected">
        <input type="button" onclick="graph.extendSelection()" value="extend selection">
        <input type="button" onclick="graph.connectSelectedNodes()" value="connect selected">
        <input type="button" onclick="graph.clear()" value="clear">
        <span>
          <input type="button" onclick="edit.addLine(getInt('line_n'), getBool('line_loop'))" value="add line">
          <input type="number" id="line_n" min="1" max="999" name="line_count" value="3">
          <input type="checkbox" id="line_loop" name="line_loop">
        </span>
        <span>
          <input type="button" onclick="edit.addStar(getInt('star_n'))" value="add star">
          <input type="number" id="star_n" min="1" max="999" name="spikes" value="4">
        </span>
        <span>
          <input type="button" onclick="edit.addLattice(getInt('lattice_x'), getInt('lattice_y'))" value="add lattice">
          <input type="number" id="lattice_x" min="1" max="999" name="x count" value="3">
          <input type="number" id="lattice_y" min="1" max="999" name="y count" value="3">
        </span>
        <span>
          <input type="button" onclick="edit.addLayer(getInt('layer_x'), getInt('layer_y'))" value="add layer">
          <input type="number" id="layer_x" min="3" max="999" name="x count" value="3">
          <input type="number" id="layer_y" min="3" max="999" name="y count" value="3">
        </span>

        <input type="button" onclick="graph.resetView()" value="reset view">
        <input type="button" onclick="edit.setData(data)" value="reload data">
      </div>

      <div id="Sim" class="tabcontent">
        <input type="button" value="Step">
        <p>
        <label>Stats:</label>
        </p>
      </div>
    </div>
    <div class="display">
    </div>
  </div>
  <noscript>
    <strong>JavaScript required</strong>
  </noscript>
</body>
</html>
